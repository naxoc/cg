<?php
function cg_generate_plugin_task($plugin_name, $prefix) {
return <<<CONTENT
<?php
// \$Id\$

/**
 * @file
 * task plugin generated by drush cg-plugin.
 */

/**
 * Specialized implementation of hook_page_manager_task_tasks(). See api-task.html for
 * more information.
 */
function {$prefix}_page_manager_tasks() {
  return array(
    // This is a 'page' task and will fall under the page admin UI
    'task type' => 'page',
    'title' => t('TITLE'),
    'admin title' => t('ADMIN TITLE'),
    'admin description' => t('DESCRIPTION'),

    'hook menu alter' => '{$prefix}_menu_alter',

    'handler type' => 'context',

    // Allow this to be enabled or disabled:
    'disabled' => variable_get('{$prefix}_disabled', TRUE),
    'enable callback' => '{$prefix}_enable',
  );
}

/**
 * Callback defined by page_manager_term_view_page_manager_tasks().
 */
function {$prefix}_menu_alter(&\$items, \$task) {
  if (variable_get('{$prefix}_disabled', TRUE)) {
    return;
  }
  \$sample_path = 'path/you/want/to/alter';
  // Override the search view handler for our purpose, but only if someone else
  // has not already done so.
  if (isset(\$items[\$sample_path]) && \$items[\$sample_path]['page callback'] == 'old_callback' || variable_get('page_manager_override_anyway', FALSE)) {
    \$items[\$sample_path]['page callback'] = '{$prefix}_callback';
    \$items[\$sample_path]['file path'] = \$task['path'];
    \$items[\$sample_path]['file'] = \$task['file'];
  }
  else {
    // automatically disable this task if it cannot be enabled.
    variable_set('{$prefix}_disabled', TRUE);
    if (!empty(\$GLOBALS['enabling_{$prefix}'])) {
      drupal_set_message(t('Page manager module is unable to enable $sample_path because some other module already has overridden with %callback.', array('%callback' => \$items[\$sample_path]['page callback'])), 'error');
    }
  }
}

/**
 * Callback to enable/disable the page from the UI.
 */
function {$prefix}_enable(\$cache, \$status) {
  variable_set('{$prefix}_disabled', \$status);

  // Set a global flag so that the menu routine knows it needs
  // to set a message if enabling cannot be done.
  if (!\$status) {
    \$GLOBALS['enabling_{$prefix}'] = TRUE;
  }
}

function {$prefix}_callback() {
  // Load my task plugin
  \$task = page_manager_get_task('$plugin_name');

  ctools_include('context');
  ctools_include('context-task-handler');
  \$output = ctools_context_handler_render(\$task, '', array(), array());
  if (\$output !== FALSE) {
    return \$output;
  }

  return 'SOMETHING';
}
CONTENT;
}